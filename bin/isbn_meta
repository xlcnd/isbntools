#!/usr/bin/env python
# -*- coding: utf-8 -*-

import sys
import logging
from isbntools import meta
from isbntools import registry


FORMATR = 'ISBN-13: %s\nTitle: %s\nAuthors: %s\nPublisher: %s\nYear: %s\n'
logging.basicConfig(level=logging.DEBUG)


def usage(available="wcat|goob|..."):
    sys.stderr.write('Usage: isbn_meta ISBN [%s]\n  ...  or try with '
                     'another service in list!\n' % available)
    sys.exit(1)


if __name__ == "__main__":
    providers = registry.services.keys()
    providers.remove('default')
    providers.remove('merge')
    available = '|'.join(providers)

    try:
        if len(sys.argv) == 3:
            service = sys.argv[2]
        else:
            service = 'default'
        r = meta(sys.argv[1], service)
        sys.stdout.write(FORMATR % (r['ISBN-13'], r['Title'],
                                    repr(r['Authors']).replace('.', ''),
                                    r['Publisher'], r['Year']))
    except:
        usage(available)
